/*! For license information please see index.js.LICENSE.txt */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("blockly/core"));else if("function"==typeof define&&define.amd)define(["blockly/core"],e);else{var n="object"==typeof exports?e(require("blockly/core")):e(t.Blockly);for(var s in n)("object"==typeof exports?exports:t)[s]=n[s]}}(this,(t=>(()=>{"use strict";var e={573:e=>{e.exports=t}},n={};function s(t){var i=n[t];if(void 0!==i)return i.exports;var a=n[t]={exports:{}};return e[t](a,a.exports,s),a.exports}s.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return s.d(e,{a:e}),e},s.d=(t,e)=>{for(var n in e)s.o(e,n)&&!s.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var i={};return(()=>{s.r(i);var t=s(573),e=s.n(t);function n(e){if(e.saveExtraState){const t=e.saveExtraState();return t?JSON.stringify(t):""}if(e.mutationToDom){const n=e.mutationToDom();return n?t.Xml.domToText(n):""}return""}function a(e){const n=new t.FieldImage(r,15,15,void 0,o);return n.args_=e,n}function o(e){const s=e.getSourceBlock();if(s.isInFlyout)return;t.Events.setGroup(!0);const i=n(s);s.minus(e.args_);const a=n(s);i!=a&&t.Events.fire(new t.Events.BlockChange(s,"mutation",null,i,a)),t.Events.setGroup(!1)}const r="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0Ij48cGF0aCBkPSJNMTggMTFoLTEyYy0xLjEwNCAwLTIgLjg5Ni0yIDJzLjg5NiAyIDIgMmgxMmMxLjEwNCAwIDItLjg5NiAyLTJzLS44OTYtMi0yLTJ6IiBmaWxsPSJ3aGl0ZSIgLz48L3N2Zz4K";function u(e){const n=new t.FieldImage(d,15,15,void 0,l);return n.args_=e,n}function l(e){const s=e.getSourceBlock();if(s.isInFlyout)return;t.Events.setGroup(!0);const i=n(s);s.plus(e.args_);const a=n(s);i!=a&&t.Events.fire(new t.Events.BlockChange(s,"mutation",null,i,a)),t.Events.setGroup(!1)}const d="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZlcnNpb249IjEuMSIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0Ij48cGF0aCBkPSJNMTggMTBoLTR2LTRjMC0xLjEwNC0uODk2LTItMi0ycy0yIC44OTYtMiAybC4wNzEgNGgtNC4wNzFjLTEuMTA0IDAtMiAuODk2LTIgMnMuODk2IDIgMiAybDQuMDcxLS4wNzEtLjA3MSA0LjA3MWMwIDEuMTA0Ljg5NiAyIDIgMnMyLS44OTYgMi0ydi00LjA3MWw0IC4wNzFjMS4xMDQgMCAyLS44OTYgMi0ycy0uODk2LTItMi0yeiIgZmlsbD0id2hpdGUiIC8+PC9zdmc+Cg==",_={elseIfCount_:0,hasElse_:!1,mutationToDom:function(){if(!this.elseIfCount_&&!this.hasElse_)return null;const t=e().utils.xml.createElement("mutation");return t.setAttribute("elseif",this.elseIfCount_),this.hasElse_&&t.setAttribute("else",1),t},domToMutation:function(t){const n=parseInt(t.getAttribute("elseif"),10)||0;this.hasElse_=!!parseInt(t.getAttribute("else"),10)||0,this.hasElse_&&!this.getInput("ELSE")&&this.appendStatementInput("ELSE").appendField(e().Msg.CONTROLS_IF_MSG_ELSE),this.updateShape_(n)},saveExtraState:function(){if(!this.elseIfCount_&&!this.hasElse_)return null;const t=Object.create(null);return this.elseIfCount_&&(t.elseIfCount=this.elseIfCount_),this.hasElse_&&(t.hasElse=!0),t},loadExtraState:function(t){const n=t.elseIfCount||0;this.hasElse_=t.hasElse||!1,this.hasElse_&&!this.getInput("ELSE")&&this.appendStatementInput("ELSE").appendField(e().Msg.CONTROLS_IF_MSG_ELSE),this.updateShape_(n)},updateShape_:function(t){for(;this.elseIfCount_<t;)this.addElseIf_();for(;this.elseIfCount_>t;)this.removeElseIf_()},plus:function(){this.addElseIf_()},minus:function(t){0!=this.elseIfCount_&&this.removeElseIf_(t)},addElseIf_:function(){this.elseIfCount_++,this.appendValueInput("IF"+this.elseIfCount_).setCheck("Boolean").appendField(e().Msg.CONTROLS_IF_MSG_ELSEIF).appendField(a(this.elseIfCount_),"MINUS"+this.elseIfCount_),this.appendStatementInput("DO"+this.elseIfCount_).appendField(e().Msg.CONTROLS_IF_MSG_THEN),this.getInput("ELSE")&&this.moveInputBefore("ELSE",null)},removeElseIf_:function(t){if(void 0!==t&&t!=this.elseIfCount_){const e=2*t,n=this.inputList;let s=n[e].connection;s.isConnected()&&s.disconnect(),s=n[e+1].connection,s.isConnected()&&s.disconnect(),this.bumpNeighbours();for(let t,n=e+2;(t=this.inputList[n])&&"ELSE"!=t.name;n++){const e=t.connection.targetConnection;e&&this.inputList[n-2].connection.connect(e)}}this.removeInput("IF"+this.elseIfCount_),this.removeInput("DO"+this.elseIfCount_),this.elseIfCount_--}};e().Extensions.isRegistered("controls_if_mutator")&&e().Extensions.unregister("controls_if_mutator"),e().Extensions.registerMutator("controls_if_mutator",_,(function(){this.getInput("IF0").insertFieldAt(0,u(),"PLUS")})),delete e().Blocks.lists_create_with,e().defineBlocksWithJsonArray([{type:"lists_create_with",message0:"%{BKY_LISTS_CREATE_EMPTY_TITLE} %1",args0:[{type:"input_dummy",name:"EMPTY"}],output:"Array",style:"list_blocks",helpUrl:"%{BKY_LISTS_CREATE_WITH_HELPURL}",tooltip:"%{BKY_LISTS_CREATE_WITH_TOOLTIP}",mutator:"new_list_create_with_mutator"}]);const h={itemCount_:0,mutationToDom:function(){const t=e().utils.xml.createElement("mutation");return t.setAttribute("items",this.itemCount_),t},domToMutation:function(t){const e=parseInt(t.getAttribute("items"),10);this.updateShape_(e)},saveExtraState:function(){return{itemCount:this.itemCount_}},loadExtraState:function(t){this.updateShape_(t.itemCount)},updateShape_:function(t){for(;this.itemCount_<t;)this.addPart_();for(;this.itemCount_>t;)this.removePart_();this.updateMinus_()},plus:function(){this.addPart_(),this.updateMinus_()},minus:function(){0!=this.itemCount_&&(this.removePart_(),this.updateMinus_())},addPart_:function(){0==this.itemCount_?(this.removeInput("EMPTY"),this.topInput_=this.appendValueInput("ADD"+this.itemCount_).appendField(u(),"PLUS").appendField(e().Msg.LISTS_CREATE_WITH_INPUT_WITH)):this.appendValueInput("ADD"+this.itemCount_),this.itemCount_++},removePart_:function(){this.itemCount_--,this.removeInput("ADD"+this.itemCount_),0==this.itemCount_&&(this.topInput_=this.appendDummyInput("EMPTY").appendField(u(),"PLUS").appendField(e().Msg.LISTS_CREATE_EMPTY_TITLE))},updateMinus_:function(){const t=this.getField("MINUS");!t&&this.itemCount_>0?this.topInput_.insertFieldAt(1,a(),"MINUS"):t&&this.itemCount_<1&&this.topInput_.removeField("MINUS")}};e().Extensions.registerMutator("new_list_create_with_mutator",h,(function(){this.getInput("EMPTY").insertFieldAt(0,u(),"PLUS"),this.updateShape_(3)})),e().Msg.PROCEDURE_VARIABLE="variable:",delete e().Blocks.procedures_defnoreturn,delete e().Blocks.procedures_defreturn,e().defineBlocksWithJsonArray([{type:"procedures_defnoreturn",message0:"%{BKY_PROCEDURES_DEFNORETURN_TITLE} %1 %2",message1:"%{BKY_PROCEDURES_DEFNORETURN_DO} %1",args0:[{type:"field_input",name:"NAME",text:""},{type:"input_dummy",name:"TOP"}],args1:[{type:"input_statement",name:"STACK"}],style:"procedure_blocks",helpUrl:"%{BKY_PROCEDURES_DEFNORETURN_HELPURL}",tooltip:"%{BKY_PROCEDURES_DEFNORETURN_TOOLTIP}",extensions:["get_procedure_def_no_return","procedure_context_menu","procedure_rename","procedure_vars"],mutator:"procedure_def_mutator"},{type:"procedures_defreturn",message0:"%{BKY_PROCEDURES_DEFRETURN_TITLE} %1 %2",message1:"%{BKY_PROCEDURES_DEFRETURN_DO} %1",message2:"%{BKY_PROCEDURES_DEFRETURN_RETURN} %1",args0:[{type:"field_input",name:"NAME",text:""},{type:"input_dummy",name:"TOP"}],args1:[{type:"input_statement",name:"STACK"}],args2:[{type:"input_value",align:"right",name:"RETURN"}],style:"procedure_blocks",helpUrl:"%{BKY_PROCEDURES_DEFRETURN_HELPURL}",tooltip:"%{BKY_PROCEDURES_DEFRETURN_TOOLTIP}",extensions:["get_procedure_def_return","procedure_context_menu","procedure_rename","procedure_vars"],mutator:"procedure_def_mutator"}]),e().Extensions.registerMixin("get_procedure_def_no_return",{getProcedureDef:function(){const t=this.argData_.map((t=>t.model.name));return[this.getFieldValue("NAME"),t,!1]},callType_:"procedures_callnoreturn"}),e().Extensions.registerMixin("get_procedure_def_return",{getProcedureDef:function(){const t=this.argData_.map((t=>t.model.name));return[this.getFieldValue("NAME"),t,!0]},callType_:"procedures_callreturn"});const p={customContextMenu:function(t){if(this.isInFlyout)return;const n=this.getFieldValue("NAME"),s=e().Msg.PROCEDURES_CREATE_DO.replace("%1",n),i=e().utils.xml.createElement("block");i.setAttribute("type",this.callType_),i.appendChild(this.mutationToDom(!0));const a=e().ContextMenu.callbackFactory(this,i);if(t.push({enabled:!0,text:s,callback:a}),this.isCollapsed())return;const o=this.getVarModels();for(const n of o){const s=e().Msg.VARIABLES_SET_CREATE_GET.replace("%1",n.name),i=e().utils.xml.createElement("block");i.setAttribute("type","variables_get"),i.appendChild(e().Variables.generateVariableFieldDom(n));const a=e().ContextMenu.callbackFactory(this,i);t.push({enabled:!0,text:s,callback:a})}}};e().Extensions.registerMixin("procedure_context_menu",p);const c={mutationToDom:function(t=!1){const n=e().utils.xml.createElement("mutation");return t&&n.setAttribute("name",this.getFieldValue("NAME")),this.argData_.forEach((s=>{const i=e().utils.xml.createElement("arg"),a=s.model;i.setAttribute("name",a.name),i.setAttribute("varid",a.getId()),i.setAttribute("argid",s.argId),t&&i.setAttribute("paramid",s.argId),n.appendChild(i)})),this.hasStatements_||n.setAttribute("statements","false"),n},domToMutation:function(t){this.hasStatements_="false"!==t.getAttribute("statements"),this.hasStatements_||this.removeInput("STACK");const e=[],n=[],s=[];for(const i of t.childNodes)"arg"==i.nodeName.toLowerCase()&&(e.push(i.getAttribute("name")),n.push(i.getAttribute("varid")||i.getAttribute("varId")),s.push(i.getAttribute("argid")));this.updateShape_(e,n,s)},saveExtraState:function(){if(!this.argData_.length&&this.hasStatements_)return null;const t=Object.create(null);return this.argData_.length&&(t.params=[],this.argData_.forEach((e=>{const n=e.model;t.params.push({name:n.name,id:n.getId(),argId:e.argId})}))),this.hasStatements_||(t.hasStatements=!1),t},loadExtraState:function(t){this.hasStatements_=!1!==t.hasStatements,this.hasStatements_||this.removeInput("STACK");const e=[],n=[],s=[];if(t.params)for(let i=0;i<t.params.length;i++){const a=t.params[i];e.push(a.name),n.push(a.id),s.push(a.argId)}this.updateShape_(e,n,s)},updateShape_:function(t,n,s){if(t.length!=n.length)throw Error("names and varIds must have the same length.");for(let t=this.argData_.length-1;t>=0;t--)this.removeArg_(this.argData_[t].argId);this.argData_=[];const i=n.length;for(let e=0;e<i;e++)this.addArg_(t[e],n[e],s[e]);e().Procedures.mutateCallers(this)},plus:function(){this.addArg_(),e().Procedures.mutateCallers(this)},minus:function(t){this.argData_.length&&(this.removeArg_(t),e().Procedures.mutateCallers(this))},addArg_:function(t=null,n=null,s=null){if(!this.argData_.length){const t=new(e().FieldLabel)(e().Msg.PROCEDURES_BEFORE_PARAMS);this.getInput("TOP").appendField(t,"WITH")}const i=this.argData_.map((t=>t.model.name));t=t||e().Variables.generateUniqueNameFromOptions(e().Procedures.DEFAULT_ARG,i);const a=e().Variables.getOrCreateVariablePackage(this.workspace,n,t,"");s=s||e().utils.idGenerator.genUid(),this.addVarInput_(t,s),this.getInput("STACK")?this.moveInputBefore(s,"STACK"):this.moveInputBefore(s,"RETURN"),this.argData_.push({model:a,argId:s})},removeArg_:function(t){this.removeInput(t,!0)&&(1==this.argData_.length&&this.getInput("TOP").removeField("WITH"),this.argData_=this.argData_.filter((e=>e.argId!=t)))},addVarInput_:function(t,n){const s=new(e().FieldTextInput)(t,this.validator_);s.onFinishEditing_=this.finishEditing_.bind(s),s.varIdsToDelete_=[],s.preEditVarModel_=null,this.appendDummyInput(n).setAlign(e().ALIGN_RIGHT).appendField(a(n)).appendField(e().Msg.PROCEDURE_VARIABLE).appendField(s,n)},validator_:function(t){const n=this.getSourceBlock(),s=n.workspace,i=n.argData_,a=n.argData_.find((t=>t.argId==this.name)),o=a.model.getId(),r=(t=t.replace(/[\s\xa0]+/g," ").trim()).toLowerCase();if(!t||!i.every((t=>t.argId==this.name||r!=t.model.name.toLowerCase())))return this.preEditVarModel_&&(a.model=this.preEditVarModel_,this.preEditVarModel_=null),e().Procedures.mutateCallers(n),null;this.varIdsToDelete_.length||(this.preEditVarModel_=a.model,s.getVariableUsesById(o).every((t=>t.id==n.id||t.getProcedureCall&&t.getProcedureCall()==n.getProcedureDef()[0]))&&this.varIdsToDelete_.push(o));let u=s.getVariable(t,"");return u?u.name!=t&&s.renameVariableById(u.getId(),t):(u=s.createVariable(t,""),this.varIdsToDelete_.push(u.getId())),u.getId()!=o&&(a.model=u),e().Procedures.mutateCallers(n),t},finishEditing_:function(t){const e=this.getSourceBlock(),n=e.argData_.find((t=>t.argId==this.name)).model.getId();this.varIdsToDelete_.forEach((t=>{t!=n&&e.workspace.deleteVariableById(t)})),this.varIdsToDelete_.length=0,this.preEditVarModel_=null}};e().Extensions.registerMutator("procedure_def_mutator",c,(function(){this.argData_=[],this.hasStatements_=!0,this.getInput("TOP").insertFieldAt(0,u(),"PLUS")})),e().Extensions.register("procedure_rename",(function(){this.getField("NAME").setValidator(e().Procedures.rename)})),e().Extensions.register("procedure_vars",(function(){const t={getVars:function(){return this.argData_.map((t=>t.model.name))},getVarModels:function(){return this.argData_.map((t=>t.model))},renameVarById:function(t,n){const s=this.argData_.find((e=>e.model.getId()==t));if(!s)return;const i=this.workspace.getVariableById(n),a=i.name;this.addVarInput_(a,n),this.moveInputBefore(n,t),this.removeInput(t),s.model=i,e().Procedures.mutateCallers(this)},updateVarName:function(t){const e=t.getId(),n=this.argData_.find((t=>t.model.getId()==e));n&&(this.setFieldValue(t.name,n.argId),n.model=t)}};this.mixin(t,!0)}));const m={itemCount_:0,mutationToDom:function(){const t=e().utils.xml.createElement("mutation");return t.setAttribute("items",this.itemCount_),t},domToMutation:function(t){const e=parseInt(t.getAttribute("items"),10);this.updateShape_(e)},saveExtraState:function(){return{itemCount:this.itemCount_}},loadExtraState:function(t){this.updateShape_(t.itemCount)},updateShape_:function(t){for(;this.itemCount_<t;)this.addPart_();for(;this.itemCount_>t;)this.removePart_();this.updateMinus_()},plus:function(){this.addPart_(),this.updateMinus_()},minus:function(){0!=this.itemCount_&&(this.removePart_(),this.updateMinus_())},addPart_:function(){0==this.itemCount_?(this.getInput("EMPTY")&&this.removeInput("EMPTY"),this.topInput_=this.appendValueInput("ADD"+this.itemCount_).appendField(u(),"PLUS").appendField(e().Msg.TEXT_JOIN_TITLE_CREATEWITH)):this.appendValueInput("ADD"+this.itemCount_),this.itemCount_++},removePart_:function(){this.itemCount_--,this.removeInput("ADD"+this.itemCount_),0==this.itemCount_&&(this.topInput_=this.appendDummyInput("EMPTY").appendField(u(),"PLUS").appendField(this.newQuote_(!0)).appendField(this.newQuote_(!1)))},updateMinus_:function(){const t=this.getField("MINUS");!t&&this.itemCount_>0?this.topInput_.insertFieldAt(1,a(),"MINUS"):t&&this.itemCount_<1&&this.topInput_.removeField("MINUS")}};e().Extensions.isRegistered("text_join_mutator")&&e().Extensions.unregister("text_join_mutator"),e().Extensions.registerMutator("text_join_mutator",m,(function(){e().Extensions.apply("text_quotes",this,!1),this.updateShape_(2)}))})(),i})()));
//# sourceMappingURL=index.js.map